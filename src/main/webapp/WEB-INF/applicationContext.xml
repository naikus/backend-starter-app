<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:context="http://www.springframework.org/schema/context"
      xmlns:util="http://www.springframework.org/schema/util"
      xsi:schemaLocation="http://www.springframework.org/schema/beans
            http://www.springframework.org/schema/beans/spring-beans.xsd
            
            http://www.springframework.org/schema/util 
            http://www.springframework.org/schema/util/spring-util-3.0.xsd
            
            http://www.springframework.org/schema/context
            http://www.springframework.org/schema/context/spring-context.xsd">
 
    <context:annotation-config/>
 
    <context:component-scan base-package="org.restapp.api, org.restapp.web, org.restapp.services, org.restapp.da" />
    
    <bean id="securityManager" class="org.apache.shiro.web.mgt.DefaultWebSecurityManager">
        <!-- Single realm app.  If you have multiple realms, use the 'realms' property instead. -->
        <!-- Custom Realm defined in org.restapp.web.security.shiro package -->
        <property name="realm" ref="DatastoreBackedRealm" />
    </bean>
    <bean id="lifecycleBeanPostProcessor" class="org.apache.shiro.spring.LifecycleBeanPostProcessor" />
    
    <bean id="shiroFilter" class="org.apache.shiro.spring.web.ShiroFilterFactoryBean">
        <property name="securityManager" ref="securityManager" />
        <property name="filters">
            <util:map>
                <!-- Custom Authz Filter defined in org.restapp.web.security.shiro package -->
                <entry key="role" value-ref="RoleAuthzFilter" />
            </util:map>
        </property>
        <property name="filterChainDefinitions">
            <value>
                /registration/** = anon
                /app/** = anon
                /api/** authcBasic
                /api/users/** = role[superuser, appuser], rest[accounts]
            </value>
        </property>
    </bean>
    
</beans>